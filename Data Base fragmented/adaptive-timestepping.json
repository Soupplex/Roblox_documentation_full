{
    "source_filename": "adaptive-timestepping.md",
    "metadata": {
        "title": "Adaptive timestepping",
        "description": "Adaptive timestepping automatically assigns physical parts to varying simulation timesteps."
    },
    "content": "The Roblox physics engine simulates all parts inside the 3D workspace through Newton's second law of motion. This law of motion is solved over time via **timesteps** and a single timestep is done within a **worldstep** in Roblox.\n\nBy default, Roblox simulates physics at 240&nbsp;Hz. Given cycles of approximately 60 frames per second, around 4&nbsp;worldsteps are advanced per frame. With **adaptive timestepping**, the physics engine automatically assigns parts to three \"solver&nbsp;islands\" by varying their simulation timestep, with an emphasis on 60&nbsp;Hz for best performance. However, parts that are \"harder\" to solve will use a faster timestep like 240&nbsp;Hz to ensure physical stability.\n\n<img src=\"../assets/physics/adaptive-timestepping/Diagram-Labels.png\" alt=\"\" width=\"100%\" />\n\nAssignment criterions are subject to change, but parts assigned to the 240&nbsp;Hz island include [assemblies](../physics/assemblies.md) with high velocity values, high acceleration values, and complex mechanisms that are hard to solve.\n\n## Enable adaptive mode\n\nTo enable adaptive timestepping in Studio:\n\n1. In the **Explorer** window, select the **Workspace** object.\n\n   <img src=\"../assets/studio/explorer/Workspace.png\" alt=\"\" width=\"320\" />\n\n2. In the **Properties** window, locate **PhysicsSteppingMethod** and select **Adaptive**.\n\n   <img src=\"../assets/physics/adaptive-timestepping/PhysicsSteppingMethod-Adaptive.png\" alt=\"\" width=\"320\" />\n\nTo observe the timestepping process in action, you can open the Studio **Microprofiler** (<kbd>Ctrl</kbd><kbd>F6</kbd>; <kbd>⌘</kbd><kbd>F6</kbd>). Once the experience is running, press <kbd>Ctrl</kbd><kbd>P</kbd> (<kbd>⌘</kbd><kbd>P</kbd>) to pause at the current frame.\n\nUnder the scope named **physicsStepped**, observe that the scope name of **worldStep** now reads **worldStep&nbsp;-&nbsp;Adaptive**.\n\n<img src=\"../assets/physics/adaptive-timestepping/Adaptive-Timestepping-Microprofiler-A.png\" alt=\"\" width=\"80%\" />\n\nHovering your cursor above **LDLPGSSolver::solve** will reveal the status of how many islands belong in each frequency bucket; **1dt&nbsp;Islands**&nbsp;(240&nbsp;Hz), **2dt&nbsp;Islands**&nbsp;(120&nbsp;Hz) and **4dt&nbsp;Islands**&nbsp;(60&nbsp;Hz).\n\n<img src=\"../assets/physics/adaptive-timestepping/Adaptive-Timestepping-Microprofiler-B.png\" alt=\"\" width=\"80%\" />\n\n## Debug visualization\n\nDuring testing, it may be useful to visualize frequencies for simulated parts. To enable this option:\n\n1. Open [Studio Settings](../studio/setup.md#customization).\n2. From the **Physics** tab, enable **Are Timesteps Shown**.\n\nOnce enabled, simulated parts will be outlined by their current simulation rate. If a part stops being simulated, either via the [sleep system](../physics/sleep-system.md) or a network ownership change, the part will no longer be outlined.\n\n<img src=\"../assets/physics/adaptive-timestepping/Diagram-Labels.png\" alt=\"\" width=\"100%\" />\n\n<figure>\n  <video src=\"../assets/physics/adaptive-timestepping/Adaptive-Timestepping.mp4\" controls width=\"100%\"></video>\n  <figcaption>Simulated parts outlined by the color representing their current simulation rate</figcaption>\n</figure>\n\n## Fixed-rate scenarios\n\nAdaptive timestepping can improve physics performance by up to 2.5 times and it is recommended in most cases. However, some experiences should use **Fixed** mode (240&nbsp;Hz), including:\n\nExperiences that require highly accurate simulations and stability, such as racing games, \"destruction\" simulations, or experiences featuring complex mechanisms like tanks.\n\nSimulations where most parts default to the 240&nbsp;Hz solver island (red outlines during [debugging](#debug-visualization)). When 240&nbsp;Hz islands interact with islands of different frequencies (60&ndash;120&nbsp;Hz), those islands are converted to 240&nbsp;Hz with an overhead that may negate any performance gains resulting from adaptive timestepping."
}